# Week07 Assignment

> 姓名：胡峻诚
>
> 学号：19241027

_阅读教材第五章并查阅网络资料，回答以下问题。_

## 1. 进程创建

`fork()`系统调用的返回值有哪几种，分别代表什么情况？

> | 返回值 | 情况                           |
> | ------ | ------------------------------ |
> | -1     | 出错                           |
> | 0      | 返回到子进程                   |
> | pid    | 将子进程的进程 ID 返回给父进程 |

## 2. 进程退出

进程的正常退出的三种方式分别是什么？

> 1. 程序正常运行结束，进程自动消失
> 2. 程序调用`exit()`函数退出
> 3. 调用`_exit()`函数退出

守护进程有哪些特点？创建一个守护进程需要哪些步骤？

> 特点：
>
> 1. 是脱离于终端，并且在后台运行的进程
> 2. 不受终端控制，即使终端退出，其仍在后台运行
>
> 创建步骤：
>
> 1. 创建子进程，父进程退出
> 2. 在子进程中创建新会话——setsid
> 3. 改变当前目录为根目录
> 4. 重设文件权限掩码（取消文件掩码）
> 5. 关闭文件描述符

僵尸进程是如何产生的？

> 父进程还没有结束而子进程结束运行，同时父进程未调用 wait 系统调用等待子进程时，子进程将成为僵尸进程

## 3. 重定向

有以下一段 c 程序，且在该程序同目录下已经存在`a.txt`和`b.txt`文件

```c
#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>

int main(){
    int fd1, fd2, fd3, fd4;
    fd1 = open("a.txt", O_RDONLY);
    fd2 = open("b.txt", O_WRONLY);
    fd3 = dup(fd1);
    fd4 = dup2(fd2, 0);
    printf("%d %d %d %d\n",fd1, fd2, fd3, fd4);
    return 0;
}
```

请问最该程序的输出是什么，并解释原因。

> 程序输出：
>
> ```
> 3 4 5 0
> ```
>
> 原因：
>
> 1. `fd1`打开了`a.txt`，由于这是第一个打开的文件，所以返回的描述符应该为 3
> 2. `fd2`打开了`b.txt`，作为下一个打开的文件，所以返回的描述符应该为 4
> 3. `fd3`复制了`fd1`，所以返回的描述符应该为 5
> 4. `fd4`复制了`fd2`，但是使用的是`dup2`，所以先将`newfd`也就是 0 关闭，然后复制`oldfd`，所以返回的描述符应该为 0

## 4. 管道

管道是如何实现进程间通信的？

> 1. 管道是 Linux 的一种最简单的通信机制。它在进程之间建立一种逻辑上的管道，一端为流入端，一端为流出端。
> 2. 一个进程在流入端写入数据，另外进程在流出段按照流入顺序读出数据，从而实现进程间的通信。

命名管道和无名管道的区别是什么？

> 1. 无名管道只能在父子进程之间通信，有名管道可以在任意进程间通信
> 2. 无名管道没有名字标识，有名管道有名称
